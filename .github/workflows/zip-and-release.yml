name: Upload zip folders to latest release

on:
  workflow_dispatch:

jobs:
  zip-and-upload:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Prepare folders
      run: |
        mkdir -p release
        shopt -s dotglob
        for dir in */ ; do
          # Bỏ qua .github và .git folder
          if [[ "$dir" == ".github/" || "$dir" == ".git/" ]]; then
            continue
          fi
          # Bỏ qua nếu là file, ví dụ README.md
          if [[ ! -d "$dir" ]]; then
            continue
          fi
          zipname="release/${dir%/}.zip"
          echo "Zipping $dir -> $zipname"
          zip -r "$zipname" "$dir"
        done

    - name: Upload to latest release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: latest
        files: release/*.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
